<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>SearchDocumentation</title>
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="SearchDocumentation";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../io/sphere/sdk/meta/ReleaseNotes.html" title="class in io.sphere.sdk.meta"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../io/sphere/sdk/meta/SphereClientTuningDocumentation.html" title="class in io.sphere.sdk.meta"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?io/sphere/sdk/meta/SearchDocumentation.html" target="_top">Frames</a></li>
<li><a href="SearchDocumentation.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#methods.inherited.from.class.io.sphere.sdk.models.Base">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">io.sphere.sdk.meta</div>
<h2 title="Class SearchDocumentation" class="title">Class SearchDocumentation</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li><a href="../../../../io/sphere/sdk/models/Base.html" title="class in io.sphere.sdk.models">io.sphere.sdk.models.Base</a></li>
<li>
<ul class="inheritance">
<li>io.sphere.sdk.meta.SearchDocumentation</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public final class <span class="typeNameLabel">SearchDocumentation</span>
extends <a href="../../../../io/sphere/sdk/models/Base.html" title="class in io.sphere.sdk.models">Base</a></pre>
<div class="block">Products can be retrieved using full-text search, filtering, faceting and sorting functionality combined.


 <p>Even though the <a href="../../../../io/sphere/sdk/meta/QueryDocumentation.html" title="class in io.sphere.sdk.meta"><code>Query API</code></a> lets you query for resources with certain attribute values, its performance is seriously affected by some attributes, specially by custom attributes, when manipulating data (i.e. filtering, sorting). Moreover, some typical operations over a list of resources, such as full-text search and facets, are simply not supported.</p>

 <p>The Search API is specially designed to support those uses cases where the Query API is not powerful enough, by providing not only full-text search, filtering, and sorting, but also statistical analysis of the data with facets.</p>

 <p>The search endpoints are supposed to be faster than the query endpoints, but for the price of eventual consistency. In other words, whenever the name of a product was changed, it will still take some seconds to propagate this change to the search index.</p>

 <p>Currently only products have a search endpoint for <a href="../../../../io/sphere/sdk/products/ProductProjection.html" title="interface in io.sphere.sdk.products"><code>ProductProjection</code></a> only. Therefore, be aware that the class to create a search request for products is called <a href="../../../../io/sphere/sdk/products/search/ProductProjectionSearch.html" title="interface in io.sphere.sdk.products.search"><code>ProductProjectionSearch</code></a>.</p>

 <p>The following examples in this document are based on the search for products. The product data defined in the SPHERE.IO platform used for the following code examples are:

 <table border="1" class="doc-table" summary="table that shows the products used for the code examples">
    <tr>
        <th>Product</th>
         <th colspan="2">Product1 "shoe"</th>
         <th colspan="2">Product2 "shirt"</th>
         <th colspan="2">Product3 "dress"</th>
     </tr>
     <tr align="center">
         <th>Variant</th>
         <th>1</th>
         <th>2</th>
         <th>1</th>
         <th>2</th>
         <th>1</th>
         <th>2</th>
     </tr>
    <tr align="center">
         <th>Color</th>
         <td>blue</td>
         <td></td>
         <td>red</td>
         <td></td>
         <td>blue</td>
         <td></td>
    </tr>
    <tr align="center">
         <th>Size</th>
         <td>38</td>
         <td>46</td>
         <td>36</td>
         <td>44</td>
         <td>40</td>
         <td>42</td>
     </tr>
 </table>


<h3 id=full-text-search>Full Text Search</h3>

 <p>With <a href="../../../../io/sphere/sdk/products/search/ProductProjectionSearch.html" title="interface in io.sphere.sdk.products.search"><code>ProductProjectionSearch</code></a> you can perform a full-text search for a specific language. On the <a href="http://dev.sphere.io/http-api-projects-products-search.html#search-text">Full-Text Search</a> documentation page you can explore which fields are included for the search and other additional information.</p>

 <p>The following example uses <a href="../../../../io/sphere/sdk/search/SearchDsl.html#withText-java.util.Locale-java.lang.String-"><code>SearchDsl.withText(java.util.Locale, String)</code></a> to search for all products containing the word "shoe" in English:</p>

 <div id="io-sphere-sdk-products-search-ProductProjectionSearchMainIntegrationTest-searchByTextInACertainLanguage--%s" class=code-example><pre><code class='java'>final ProductProjectionSearch search = ProductProjectionSearch.ofStaged().withText(ENGLISH, "shoe");
final PagedSearchResult&lt;ProductProjection&gt; result = executeSearch(search);
assertThat(resultsToIds(result)).containsOnly(product1.getId());
</code><p>See the <a href="https://github.com/sphereio/sphere-jvm-sdk/blob/master/sphere-models/src/it/java/io/sphere/sdk/products/search/ProductProjectionSearchMainIntegrationTest.java" target="_blank">test code</a>.</pre></div>



<h3 id=pagination>Pagination</h3>

 <p>Use <a href="../../../../io/sphere/sdk/search/SearchDsl.html#withOffset-long-"><code>SearchDsl.withOffset(long)</code></a> and <a href="../../../../io/sphere/sdk/search/SearchDsl.html#withLimit-long-"><code>SearchDsl.withLimit(long)</code></a> for pagination. An extended explanation about how pagination works in SPHERE.IO can be found in <a href="../../../../io/sphere/sdk/meta/QueryDocumentation.html" title="class in io.sphere.sdk.meta"><code>QueryDocumentation</code></a>.</p>

 <p>The following request skips the first 50 products and limits the result set to only 25 products:</p>

 <div id="io-sphere-sdk-products-search-ProductProjectionSearchMainIntegrationTest-paginationExample--%s" class=code-example><pre><code class='java'>final int offset = 10;
final int limit = 25;
final ProductProjectionSearch search = ProductProjectionSearch.ofStaged()
        .withOffset(offset)
        .withLimit(limit);
final PagedSearchResult&lt;ProductProjection&gt; result = executeSearch(search);
final int remainingProducts = max(result.getTotal() - offset, 0);
final int expectedProducts = min(limit, remainingProducts);
assertThat(result.size()).isEqualTo(expectedProducts);
assertThat(result.getOffset()).isEqualTo(offset);
</code><p>See the <a href="https://github.com/sphereio/sphere-jvm-sdk/blob/master/sphere-models/src/it/java/io/sphere/sdk/products/search/ProductProjectionSearchMainIntegrationTest.java" target="_blank">test code</a>.</pre></div>



<h3 id=sorting>Sorting</h3>

 <p>Any attribute you can sort by, allows both sort directions, ascending and descending. On the <a href="http://dev.sphere.io/http-api-projects-products-search.html#search-sorting">Sorting</a> documentation page you can explore for which fields you can sort for. Use <a href="../../../../io/sphere/sdk/products/search/ProductProjectionSortSearchModel.html" title="class in io.sphere.sdk.products.search"><code>ProductProjectionSortSearchModel</code></a> class to build sort expressions easily.</p>

 <p>The code sample below shows a request for all products which will be sorted by size in an ascending direction:</p>

 <div id="io-sphere-sdk-products-search-ProductProjectionSearchSortIntegrationTest-sortByAttributeAscending--%s" class=code-example><pre><code class='java'>final ProductProjectionSearch search = ProductProjectionSearch.ofStaged()
        .withSort(sort -&gt; sort.allVariants().attribute().ofNumber(ATTR_NAME_SIZE).byAsc());
final PagedSearchResult&lt;ProductProjection&gt; result = executeSearch(search);
assertThat(resultsToIds(result)).containsExactly(product2.getId(), product1.getId(), product3.getId());
</code><p>See the <a href="https://github.com/sphereio/sphere-jvm-sdk/blob/master/sphere-models/src/it/java/io/sphere/sdk/products/search/ProductProjectionSearchSortIntegrationTest.java" target="_blank">test code</a>.</pre></div>

 <p>When sorting on multi-valued attributes, such as attributes from product variants, you can also choose which value should be used for sorting. By default, the value selected is the best-matching according to the sorting direction, or in other words, the minimum value for ascending and the maximum value for descending sort. This behaviour can be easily inverted, as explained in the <a href="http://dev.sphere.io/http-api-projects-products-search.html#search-sorting-attribute">Sorting by Attributes</a> documentation page.</p>

 <p>In the following example the products are sorted by size in an ascending direction, but sorted using the highest size value within each product variants instead:</p>

 <div id="io-sphere-sdk-products-search-ProductProjectionSearchSortIntegrationTest-sortWithAdditionalParameterByAttributeAscending--%s" class=code-example><pre><code class='java'>final ProductProjectionSearch search = ProductProjectionSearch.ofStaged()
        .withSort(sort -&gt; sort.allVariants().attribute().ofNumber(ATTR_NAME_SIZE).byAscWithMax());
final PagedSearchResult&lt;ProductProjection&gt; result = executeSearch(search);
assertThat(resultsToIds(result)).containsExactly(product3.getId(), product2.getId(), product1.getId());
</code><p>See the <a href="https://github.com/sphereio/sphere-jvm-sdk/blob/master/sphere-models/src/it/java/io/sphere/sdk/products/search/ProductProjectionSearchSortIntegrationTest.java" target="_blank">test code</a>.</pre></div>

 <p>Alternatively, you can provide the sort request directly, even though this method is unsafe and therefore not recommended.</p>

 <p>Here is the alternative code equivalent to the previous sorting by size:</p>

 <div id="io-sphere-sdk-products-search-ProductProjectionSearchSortIntegrationTest-sortWithSimpleExpression--%s" class=code-example><pre><code class='java'>final SortExpression&lt;ProductProjection&gt; sort = SortExpression.of("variants.attributes." + ATTR_NAME_SIZE + " asc.max");
final ProductProjectionSearch search = ProductProjectionSearch.ofStaged().withSort(sort);
final PagedSearchResult&lt;ProductProjection&gt; result = executeSearch(search);
assertThat(resultsToIds(result)).containsExactly(product3.getId(), product2.getId(), product1.getId());
</code><p>See the <a href="https://github.com/sphereio/sphere-jvm-sdk/blob/master/sphere-models/src/it/java/io/sphere/sdk/products/search/ProductProjectionSearchSortIntegrationTest.java" target="_blank">test code</a>.</pre></div>

 <p>Providing a list of sort expressions has the effect of multi-sorting, as it is demonstrated in the following example:</p>

 <div id="io-sphere-sdk-products-search-ProductProjectionSearchSortIntegrationTest-sortByMultipleAttributes--%s" class=code-example><pre><code class='java'>final ProductProjectionSearch singleSortedRequest = ProductProjectionSearch.ofStaged()
        .plusSort(sort -&gt; sort.allVariants().attribute().ofString(ATTR_NAME_COLOR).byAsc());
final PagedSearchResult&lt;ProductProjection&gt; resultNameAsc = executeSearch(singleSortedRequest
        .plusSort(sort -&gt; sort.name().locale(ENGLISH).byAsc()));
final PagedSearchResult&lt;ProductProjection&gt; resultNameDesc = executeSearch(singleSortedRequest
        .plusSort(sort -&gt; sort.name().locale(ENGLISH).byDesc()));
assertThat(resultsToIds(resultNameAsc)).containsExactly(product3.getId(), product1.getId(), product2.getId());
assertThat(resultsToIds(resultNameDesc)).containsExactly(product1.getId(), product3.getId(), product2.getId());
</code><p>See the <a href="https://github.com/sphereio/sphere-jvm-sdk/blob/master/sphere-models/src/it/java/io/sphere/sdk/products/search/ProductProjectionSearchSortIntegrationTest.java" target="_blank">test code</a>.</pre></div>




 <h3 id=faceting>Faceting</h3>

 <h4 id=facet-expressions>Expressions</h4>

 <p>Facets calculate statistical counts based on the values associated with an attribute. Building facet expressions is very easy thanks to the <a href="../../../../io/sphere/sdk/products/search/ProductProjectionFacetSearchModel.html" title="class in io.sphere.sdk.products.search"><code>ProductProjectionFacetSearchModel</code></a> class. You can consult the <a href="http://dev.sphere.io/http-api-projects-products-search.html#search-facets">Facets</a> HTTP API documentation for more information.</p>

 <p>There are three types of facets: <a href="../../../../io/sphere/sdk/search/TermFacetResult.html" title="class in io.sphere.sdk.search"><code>TermFacetResult</code></a>, <a href="../../../../io/sphere/sdk/search/RangeFacetResult.html" title="class in io.sphere.sdk.search"><code>RangeFacetResult</code></a> and <a href="../../../../io/sphere/sdk/search/FilteredFacetResult.html" title="class in io.sphere.sdk.search"><code>FilteredFacetResult</code></a>. Next are presented example codes of each type to better illustrate how these facet types work.</p>

 <p>The Term Facet result obtained with the following code contains all different size values found in the products, along with the statistical count of the amount of product variants with that value associated:</p>

 <div id="io-sphere-sdk-products-search-ProductProjectionSearchFacetsIntegrationTest-termFacetsAreParsed--%s" class=code-example><pre><code class='java'>final TermFacetExpression&lt;ProductProjection&gt; facetExpr = FACET.allVariants().attribute().ofString(ATTR_NAME_COLOR).allTerms();
final ProductProjectionSearch search = ProductProjectionSearch.ofStaged().plusFacets(facetExpr);
final PagedSearchResult&lt;ProductProjection&gt; result = executeSearch(search);
final TermFacetResult termFacetResult = result.getTermFacetResult(facetExpr);
assertThat(termFacetResult.getMissing()).isGreaterThanOrEqualTo(3);
assertThat(termFacetResult.getTotal()).isEqualTo(3);
assertThat(termFacetResult.getOther()).isEqualTo(0);
assertThat(termFacetResult.getTerms()).isEqualTo(asList(TermStats.of("blue", 2), TermStats.of("red", 1)));
</code><p>See the <a href="https://github.com/sphereio/sphere-jvm-sdk/blob/master/sphere-models/src/it/java/io/sphere/sdk/products/search/ProductProjectionSearchFacetsIntegrationTest.java" target="_blank">test code</a>.</pre></div>

 <p>In contrast, the Filtered Facet result contains the statistical count for some certain values specified in the request, in this case the amount of variants with blue color:</p>

 <div id="io-sphere-sdk-products-search-ProductProjectionSearchFacetsIntegrationTest-filteredFacetsAreParsed--%s" class=code-example><pre><code class='java'>final FilteredFacetExpression&lt;ProductProjection&gt; facetExpr = FACET.allVariants().attribute().ofString(ATTR_NAME_COLOR).onlyTerm("blue");
final ProductProjectionSearch search = ProductProjectionSearch.ofStaged().plusFacets(facetExpr);
final PagedSearchResult&lt;ProductProjection&gt; result = executeSearch(search);
final FilteredFacetResult filteredFacetResult = result.getFilteredFacetResult(facetExpr);
assertThat(filteredFacetResult.getCount()).isEqualTo(2);
</code><p>See the <a href="https://github.com/sphereio/sphere-jvm-sdk/blob/master/sphere-models/src/it/java/io/sphere/sdk/products/search/ProductProjectionSearchFacetsIntegrationTest.java" target="_blank">test code</a>.</pre></div>

 <p>You can also request statistics (i.e. count, minimum and maximum values, as well as the sum and arithmetic mean) about a range of values, like it is done with size in the following example within the range [0, +∞):</p>

 <div id="io-sphere-sdk-products-search-ProductProjectionSearchFacetsIntegrationTest-rangeFacetsAreParsed--%s" class=code-example><pre><code class='java'>final RangeFacetExpression&lt;ProductProjection&gt; facetExpr = FACET.allVariants().attribute().ofNumber(ATTR_NAME_SIZE).onlyGreaterThanOrEqualTo(ZERO);
final ProductProjectionSearch search = ProductProjectionSearch.ofStaged().plusFacets(facetExpr);
final PagedSearchResult&lt;ProductProjection&gt; result = executeSearch(search);
final RangeStats rangeStats = result.getRangeFacetResult(facetExpr).getRanges().get(0);
assertThat(rangeStats.getLowerEndpoint()).isEqualTo("0.0");
assertThat(rangeStats.getUpperEndpoint()).isNull();
assertThat(rangeStats.getCount()).isEqualTo(6L);
assertThat(rangeStats.getMin()).isEqualTo("36.0");
assertThat(rangeStats.getMax()).isEqualTo("46.0");
assertThat(rangeStats.getSum()).isEqualTo("246.0");
assertThat(rangeStats.getMean()).isEqualTo(41.0);
</code><p>See the <a href="https://github.com/sphereio/sphere-jvm-sdk/blob/master/sphere-models/src/it/java/io/sphere/sdk/products/search/ProductProjectionSearchFacetsIntegrationTest.java" target="_blank">test code</a>.</pre></div>

 <p>There is also the possibility to provide the facet expression directly, although it is unsafe and thus not recommended.</p>

 <p>In the following code the same request as in the Term Facet example is reproduced, but providing a facet expression now instead:</p>

 <div id="io-sphere-sdk-products-search-ProductProjectionSearchFacetsIntegrationTest-simpleFacetsAreParsed--%s" class=code-example><pre><code class='java'>final TermFacetExpression&lt;ProductProjection&gt; facetExpr = TermFacetExpression.of("variants.attributes." + ATTR_NAME_COLOR);
final ProductProjectionSearch search = ProductProjectionSearch.ofStaged().plusFacets(facetExpr);
final TermFacetResult termFacetResult = executeSearch(search).getTermFacetResult(facetExpr);
assertThat(termFacetResult.getMissing()).isGreaterThanOrEqualTo(3);
assertThat(termFacetResult.getTotal()).isEqualTo(3);
assertThat(termFacetResult.getOther()).isEqualTo(0);
assertThat(termFacetResult.getTerms()).isEqualTo(asList(TermStats.of("blue", 2), TermStats.of("red", 1)));
</code><p>See the <a href="https://github.com/sphereio/sphere-jvm-sdk/blob/master/sphere-models/src/it/java/io/sphere/sdk/products/search/ProductProjectionSearchFacetsIntegrationTest.java" target="_blank">test code</a>.</pre></div>

 <h4 id=facet-alias>Alias</h4>

 <p>Additionally, facets allow to specify an alias which will then replace the attribute path in the result. This functionality allows to calculate different types of facets on the same attribute. There is an extended explanation with examples in the API documentation for <a href="http://dev.sphere.io/http-api-projects-products-search.html#search-facets">Facets</a>.</p>

 <p>In order to use it, the SDK offers a method that allows to define the desired alias:</p>

 <div id="io-sphere-sdk-products-search-ProductProjectionSearchFacetsIntegrationTest-termFacetsSupportsAlias--%s" class=code-example><pre><code class='java'>final String allFacetAlias = "my-facet";
final String blueFacetAlias = "my-blue-facet";
final TermFacetExpression&lt;ProductProjection&gt; allFacetExpr = FACET.allVariants().attribute().ofString(ATTR_NAME_COLOR).withAlias(allFacetAlias).allTerms();
final FilteredFacetExpression&lt;ProductProjection&gt; blueFacetExpr = FACET.allVariants().attribute().ofString(ATTR_NAME_COLOR).withAlias(blueFacetAlias).onlyTerm("blue");
final ProductProjectionSearch search = ProductProjectionSearch.ofStaged()
        .plusFacets(allFacetExpr)
        .plusFacets(blueFacetExpr);
final PagedSearchResult&lt;ProductProjection&gt; result = executeSearch(search);
final TermFacetResult allFacetResult = result.getTermFacetResult(allFacetExpr);
final FilteredFacetResult blueFacetResult = result.getFilteredFacetResult(blueFacetAlias);
assertThat(allFacetExpr.resultPath()).isEqualTo(allFacetAlias);
assertThat(blueFacetExpr.resultPath()).isEqualTo(blueFacetAlias);
assertThat(allFacetResult.getTerms()).isEqualTo(asList(TermStats.of("blue", 2), TermStats.of("red", 1)));
assertThat(blueFacetResult.getCount()).isEqualTo(2);
</code><p>See the <a href="https://github.com/sphereio/sphere-jvm-sdk/blob/master/sphere-models/src/it/java/io/sphere/sdk/products/search/ProductProjectionSearchFacetsIntegrationTest.java" target="_blank">test code</a>.</pre></div>




 <h3 id=filtering>Filtering</h3>

 <h4 id=filter-types>Types</h4>

 <p>When searching for products, there are three stages of the process where filters can be applied, as shown in the following drawing:</p>

 <img class="theme-img" src="../../../../documentation-resources/images/search/search-phases.png" alt="Filter types">
 <p class="image-caption">Filter types</p>

 <dl>
    <dt>Filter Query: <a href="../../../../io/sphere/sdk/search/FilterDsl.html#withQueryFilters-java.util.List-"><code>FilterDsl.withQueryFilters(java.util.List)</code></a>.</dt>
    <dd>This parameter allows to filter products BEFORE facets have been calculated, therefore this scope affects both results and facets.</dd>

    <dt>Filter Results (in the HTTP API it is called just "filter"): <a href="../../../../io/sphere/sdk/search/FilterDsl.html#withResultFilters-java.util.List-"><code>FilterDsl.withResultFilters(java.util.List)</code></a></dt>
    <dd>This parameter allows to filter products AFTER facets have been calculated, therefore this scope affects the results only. Using this filter only makes sense when used together with facets, otherwise Filter Query should be preferred for performance reasons.</dd>

    <dt>Filter Facets: <a href="../../../../io/sphere/sdk/search/FilterDsl.html#withFacetFilters-java.util.List-"><code>FilterDsl.withFacetFilters(java.util.List)</code></a></dt>
    <dd>This parameter allows to filter those products used for facets calculation only, without affecting the results whatsoever. All facet calculations are affected except for those facets operating on the same field as the filter, enabling faceted search when combined with Filter Results.</dd>
 </dl>

  <table border="1" class="doc-table" summary="table that shows which filter is applied to which output">
    <tr>
        <th>&nbsp;</th>
        <th>Does it filter results?</th>
        <th>Does it filter facets?</th>
    </tr>
    <tr align="center">
        <th>Filter Query</th>
        <td>Yes</td>
        <td>Yes</td>
    </tr>
    <tr align="center">
        <th>Filter Results</th>
        <td>Yes</td>
        <td>No</td>
    </tr>
    <tr align="center">
        <th>Filter Facets</th>
        <td>No</td>
        <td>Yes</td>
    </tr>
    <tr align="center">
        <th>No filter</th>
        <td>No</td>
        <td>No</td>
    </tr>
 </table>

 <p>For further explanation, some diagrams regarding the filter mechanism can be found in the <a href="http://slides.com/lauraluiz/filters-and-facets">Filters and Facets</a> presentation.</p>

 <h4 id=filter-expressions>Expressions</h4>

 <p>You can easily build filter expressions with the <a href="../../../../io/sphere/sdk/products/search/ProductProjectionFilterSearchModel.html" title="class in io.sphere.sdk.products.search"><code>ProductProjectionFilterSearchModel</code></a> class. For more details, check the HTTP API documentation for <a href="http://dev.sphere.io/http-api-projects-products-search.html#search-filters">Filters</a>.</p>

 <p>In the following example only the products with red color are returned:</p>

 <div id="io-sphere-sdk-products-search-ProductProjectionSearchFiltersIntegrationTest-filtersByTerm--%s" class=code-example><pre><code class='java'>final ProductProjectionSearch search = ProductProjectionSearch.ofStaged()
        .plusQueryFilters(filter -&gt; filter.allVariants().attribute().ofString(ATTR_NAME_COLOR).by("red"));
final PagedSearchResult&lt;ProductProjection&gt; result = executeSearch(search);
assertThat(resultsToIds(result)).containsOnly(product2.getId());
</code><p>See the <a href="https://github.com/sphereio/sphere-jvm-sdk/blob/master/sphere-models/src/it/java/io/sphere/sdk/products/search/ProductProjectionSearchFiltersIntegrationTest.java" target="_blank">test code</a>.</pre></div>

 <p>Besides filtering by terms, you can also filter by a range of values, as shown in the following code.</p>

 <p>Here we are requesting only those products with at least one variant having the size attribute greater than or equals to 44:</p>

 <div id="io-sphere-sdk-products-search-ProductProjectionSearchFiltersIntegrationTest-filtersByRange--%s" class=code-example><pre><code class='java'>final ProductProjectionSearch search = ProductProjectionSearch.ofStaged()
        .plusQueryFilters(filter -&gt; filter.allVariants().attribute().ofNumber(ATTR_NAME_SIZE).byGreaterThanOrEqualTo(valueOf(44)));
final PagedSearchResult&lt;ProductProjection&gt; result = executeSearch(search);
assertThat(resultsToIds(result)).containsOnly(product1.getId(), product2.getId());
</code><p>See the <a href="https://github.com/sphereio/sphere-jvm-sdk/blob/master/sphere-models/src/it/java/io/sphere/sdk/products/search/ProductProjectionSearchFiltersIntegrationTest.java" target="_blank">test code</a>.</pre></div>

 <p>There is also the possibility to provide the filter expression directly, although it is unsafe and thus not recommended.</p>

 <p>In the following example the same filter by size is requested as previously, but now in this way:</p>

 <div id="io-sphere-sdk-products-search-ProductProjectionSearchFiltersIntegrationTest-simpleFilterByRange--%s" class=code-example><pre><code class='java'>final FilterExpression&lt;ProductProjection&gt; filterExpr = FilterExpression.of("variants.attributes." + ATTR_NAME_SIZE + ":range(44 to *)");
final ProductProjectionSearch search = ProductProjectionSearch.ofStaged().plusQueryFilters(singletonList(filterExpr));
final PagedSearchResult&lt;ProductProjection&gt; result = executeSearch(search);
assertThat(resultsToIds(result)).containsOnly(product1.getId(), product2.getId());
</code><p>See the <a href="https://github.com/sphereio/sphere-jvm-sdk/blob/master/sphere-models/src/it/java/io/sphere/sdk/products/search/ProductProjectionSearchFiltersIntegrationTest.java" target="_blank">test code</a>.</pre></div>


 <h3 id=model>Product Projection Search Model</h3>

 <p>The Search Model for products is currently in an experimental status, so please be aware it will probably suffer breaking changes in the future.</p>

 <p>The <a href="../../../../io/sphere/sdk/products/search/ProductProjectionSearchModel.html" title="class in io.sphere.sdk.products.search"><code>ProductProjectionSearchModel</code></a> class offers a domain-specific language (DSL) to build expressions accepted by the search endpoint, which can be otherwise a bit complex to write. In particular, this DSL allows you to build expressions for <a href="#sorting">sorting</a>, <a href="#filtering">filtering</a> and <a href="#faceting">faceting</a>, as it is demonstrated in the corresponding sections.</p>

 <p>In order to build an expression, first you will be required to select the action to apply (i.e. <a href="../../../../io/sphere/sdk/products/search/ProductProjectionSearchModel.html#filter--"><code>ProductProjectionSearchModel.filter()</code></a>, <a href="../../../../io/sphere/sdk/products/search/ProductProjectionSearchModel.html#facet--"><code>ProductProjectionSearchModel.facet()</code></a> and <a href="../../../../io/sphere/sdk/products/search/ProductProjectionSearchModel.html#sort--"><code>ProductProjectionSearchModel.sort()</code></a>).</p>

 <p>Then you need to build the path of the attribute you want to apply that action to, for example <a href="../../../../io/sphere/sdk/products/search/ProductDataFilterSearchModel.html#lastModifiedAt--"><code>ProductDataFilterSearchModel.lastModifiedAt()</code></a> represents the <code>lastModifiedAt</code> attribute on a product. In the case of custom attributes, you also need to provide the attribute name and select the primary type of the attribute.</p>

 <p>Finally, you need to indicate the criteria used for the desired operation. For example you would use <a href="../../../../io/sphere/sdk/search/model/TermFilterSearchModel.html#byAny-java.lang.Iterable-"><code>TermFilterSearchModel.byAny(java.lang.Iterable&lt;V&gt;)</code></a> if you want to filter by any of the given values.</p>

 <p>Notice that even though the Search Model expects values of a certain type based on the attribute, you can force it to accept simple strings as shown in the following example:</p>

 <div id="io-sphere-sdk-products-search-ProductProjectionSearchFiltersIntegrationTest-filterByValueAsString%s" class=code-example><pre><code class='java'>final ProductProjectionSearch search = ProductProjectionSearch.ofStaged()
        .plusQueryFilters(filter -&gt; filter.allVariants().attribute().ofNumber(ATTR_NAME_SIZE).byAnyAsString(asList("36", "38")));
final PagedSearchResult&lt;ProductProjection&gt; result = executeSearch(search);
assertThat(resultsToIds(result)).containsOnly(product1.getId(), product2.getId());
</code><p>See the <a href="https://github.com/sphereio/sphere-jvm-sdk/blob/master/sphere-models/src/it/java/io/sphere/sdk/products/search/ProductProjectionSearchFiltersIntegrationTest.java" target="_blank">test code</a>.</pre></div></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.io.sphere.sdk.models.Base">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;io.sphere.sdk.models.<a href="../../../../io/sphere/sdk/models/Base.html" title="class in io.sphere.sdk.models">Base</a></h3>
<code><a href="../../../../io/sphere/sdk/models/Base.html#equals-java.lang.Object-">equals</a>, <a href="../../../../io/sphere/sdk/models/Base.html#hashCode--">hashCode</a>, <a href="../../../../io/sphere/sdk/models/Base.html#toString--">toString</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, finalize, getClass, notify, notifyAll, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../io/sphere/sdk/meta/ReleaseNotes.html" title="class in io.sphere.sdk.meta"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../io/sphere/sdk/meta/SphereClientTuningDocumentation.html" title="class in io.sphere.sdk.meta"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?io/sphere/sdk/meta/SearchDocumentation.html" target="_top">Frames</a></li>
<li><a href="SearchDocumentation.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#methods.inherited.from.class.io.sphere.sdk.models.Base">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small><link rel='stylesheet' href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css'><script src='//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js'></script><script>hljs.initHighlightingOnLoad();</script><style>code {font-size: 1.0em;font-family: monospace;}</style><script src='https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js'></script>
<span id='custom-javascripts'></span>
<script>var pathPrefix = $(".navList a[href$='index-all.html']").attr("href").replace("index-all.html", ""); var closingScriptTag = "</" + "script>"; 
$('#custom-javascripts').append("<script src='" + pathPrefix + "documentation-resources/javascripts/main.js'>" + closingScriptTag + "<link rel='stylesheet' href='" + pathPrefix + "documentation-resources/stylesheets/main.css'>");</script></small></p>
</body>
</html>
